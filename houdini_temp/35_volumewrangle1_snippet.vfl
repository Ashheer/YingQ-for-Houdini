int maxiter = chi("Blurring_Iterations");

vector dir = v@dir;
vector ctr = v@P;

float val = f@density;

float blurrad = chf("Blur_Radius");
float inc = blurrad / float(maxiter);
float start = -.5 * blurrad;

for(int i = 0; i < maxiter; i++)
{
    vector sppos = ctr + dir * (start + inc * i);
    float nval = 0.0;
    if(abs(sppos.x) < 6 && abs(sppos.y) < 6 && abs(sppos.z) < 6)
        nval = volumesample(0, 0, sppos);
        
    val += nval;
}

f@density = val / float(maxiter);