int maxiter = chf("Num_of_Samples");

vector dir = v@dir;
vector ctr = v@P;

float blurdia = chf("blurdia");
float inc = blurdia/float(maxiter);
float start = -0.5*blurdia;

float val = f@density;

for(int i = 0; i<maxiter; i++){
    vector ctp = ctr+(start+inc*i)*dir;
    float nval = 0;
    if(abs(ctp.x)<1.5 && abs(ctp.y)<1.5 && abs(ctp.z)<0.5)
        nval =volumesample(0, "density", ctp);
    val = val+nval; 
}
f@density = val/float(maxiter);